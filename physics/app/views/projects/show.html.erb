<body class="body-main">
<!--Navbar-->
<%= render "layouts/header" %>
<div class="container-fluid">
  <div class="col-md-12">
    <div class="col-md-4">
      <table class="table-hover">
        <tbody>

          <tr>
            <%= form_for @project do |f| %>
            <td>
              <p>Profile Field 1</p>
            <td>  
              <div class="input-group profile-group">
                <input type = "text" class="form-control profile-form" placeholder="Profile Field 1" aria-describedby="Persona-info-field-1" disabled="disabled">
                <span class="input-group-btn">
                  <button class="btn btn-default profile-btn" type="button">
                    <span class="glyphicon glyphicon-pencil form-group-addon"></span>
                  </button>
                </span>
              </div>
            </td>
            <td>
              <p><%= f.label :name %></p>
            </td>
            <td>  
              <div class="input-group profile-group">
                <%= f.text_field :name, class: 'form-control profile-form', placeholder: "Enter Project Name", 'aria-describedby' => "New-Email"%>
                <span class="input-group-btn">
                  <%= f.submit class:"btn btn-primary profile-btn", value: "test" %>
                </span>
              </div>
            </td>
            <% end %>
          </tr>
          <tr>
            <%= form_for @project do |f| %>
            <td>
              <p><%= f.label :description %></p>
            <td>  
              <div class="input-group profile-group">
                <%= f.text_field :description, class: 'form-control profile-form', placeholder: "Enter Description", 'aria-describedby' => "New-Password"%>
                <span class="input-group-btn">
                  <%= f.submit class:"btn btn-primary profile-btn" %>
                </span>
              </div>
            </td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="col-md-6"></div>
    <div class="col-md-4">
      <p id="notice"><%= notice %></p>
      <p><strong>Name:</strong><%= @project.name %></p>
      <p><strong>Description:</strong><%= @project.description %></p>
      <%= link_to 'Destroy this project', @project, method: :delete, data: { confirm: 'Are you sure?' } %>
    </div>
  </div>
  <div class="col-md-12">

<p>
  <strong>Owner:</strong>
  <%= @project.owner_id %>
</p>

<%= link_to 'Edit', edit_project_path(@project) %> |
<%= link_to 'List of Projects', projects_path %>
<% provide(:title, "Editor") %>

  <div class="col-md-4">
    <!--Editor-->
    <div class="col-md-12">
      <textarea class="form-control editor" id="editor-input"></textarea>
    </div>
    <script>
    	var project = new Firebase('https://brilliant-fire-2071.firebaseio.com/Projects/'.concat("project".concat(String(<%= @project.id %>))));

    	$('#editor-input').on('input', function() {
    	  	var text = $('#editor-input').val();
    		project.push().set({text: text});
    	});

    	project.on('child_added', function(snapshot) {
    	var message = snapshot.val();
    	$('#editor-input').val(message.text).change();
    	});
    </script>
    <!--Chatbox-->
    <div class="col-md-12">
      <!--Chatlog-->

      <div id='messagesDiv'>
        <input type='text' id='messageInput' placeholder='Message'>
        <script>
          var chat = new Firebase('https://brilliant-fire-2071.firebaseio.com/Projects/'.concat("chat".concat(String(<%= @project.id %>))));
          $('#messageInput').keypress(function (e) {
            if (e.keyCode == 13) {
              var name = <%= current_user.id %>;
              var text = $('#messageInput').val();
              chat.push({name: name, text: text});
              $('#messageInput').val('');
            }
          });
          chat.on('child_added', function(snapshot) {
            var message = snapshot.val();
            displayChatMessage(message.name, message.text);
          });
          function displayChatMessage(name, text) {
            $('<div/>').text(text).prepend($('<em/>').text(name+': ')).appendTo($('#messagesDiv'));
            $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
          };
        </script>
      </div>
    </div>
    <div class="col-md-12">
      <!--SMS-->
      <div>
      </div>
    </div>
  </div>
  <!--Empty Coloumn-->
  <div class="col-md-1">
  </div>
  <!--Editor Render-->
  <div class="col-md-6 editor-render">
    <div class="sheet-music" id="sheet-music"></div>
    <div id="warnings"></div>
  </div>
</div>
<!-- Editing tab -->
<div>
  Users with access to this 
  <% if @project.owner_id == current_user.id %>
    <% @user = @project.users %>
    <% @user.each do |f| %>
      <%= link_to user_path(f) do %><%= f.username %><% end %>
    <% end %>
  <% end %>
</div>
</body>
</html>